openapi: 3.0.3
info:
  title: Personal Finance API
  description: API completa para gestión de finanzas personales con autenticación JWT
  version: 2.0.0
  contact:
    name: Personal Finance API
    url: http://localhost:3030

servers:
  - url: http://localhost:3030/api
    description: Development server

tags:
  - name: auth
    description: Autenticación y gestión de usuarios
  - name: gastos
    description: Operaciones con gastos reales generados
  - name: gastos-unicos
    description: Operaciones con gastos únicos (no recurrentes)
  - name: compras
    description: Operaciones con compras en cuotas
  - name: gastos-recurrentes
    description: Operaciones con gastos recurrentes (mensuales, anuales, etc.)
  - name: debitos-automaticos
    description: Operaciones con débitos automáticos (suscripciones, servicios)
  - name: tarjetas
    description: Gestión de tarjetas de débito y crédito del usuario
  - name: tipo-cambio
    description: Sistema multi-moneda - Gestión de tipos de cambio USD/ARS
  - name: proyeccion
    description: Proyección de gastos futuros basada en gastos recurrentes, débitos y cuotas
  - name: salud-financiera
    description: Análisis de salud financiera con scoring y recomendaciones

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtenido del endpoint de login

  schemas:
    StandardResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Indica si la operación fue exitosa
        data:
          description: Datos de la respuesta
        meta:
          type: object
          properties:
            total:
              type: integer
              description: Total de elementos
            type:
              type: string
              description: Tipo de respuesta
              enum: [collection, single]
            pagination:
              $ref: '#/components/schemas/Pagination'
    
    StandardError:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: Mensaje de error
        details:
          description: Detalles adicionales del error
        timestamp:
          type: string
          format: date-time
          description: Timestamp del error

    ValidationError:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Error de validación"
        details:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                description: Campo que falló la validación
              message:
                type: string
                description: Mensaje de error específico
              value:
                description: Valor que causó el error
        timestamp:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        limit:
          type: integer
          description: Número de elementos por página
        offset:
          type: integer  
          description: Número de elementos saltados
        hasNext:
          type: boolean
          description: Indica si hay página siguiente
        hasPrev:
          type: boolean
          description: Indica si hay página anterior

    Gasto:
      type: object
      properties:
        id:
          type: integer
          description: ID único del gasto
          example: 123
        fecha:
          type: string
          format: date
          description: Fecha del gasto
          example: "2024-01-15"
        monto_ars:
          type: string
          pattern: '^[0-9]+\.[0-9]{2}$'
          description: Monto en pesos argentinos
          example: "1500.50"
        monto_usd:
          type: string
          pattern: '^[0-9]+\.[0-9]{2}$'
          nullable: true
          description: Monto en dólares estadounidenses
          example: "25.30"
        descripcion:
          type: string
          minLength: 3
          maxLength: 255
          description: Descripción del gasto
          example: "Almuerzo en restaurante"
        categoria_gasto_id:
          type: integer
          description: ID de la categoría del gasto
          example: 5
        importancia_gasto_id:
          type: integer
          description: ID de la importancia del gasto
          example: 2
        frecuencia_gasto_id:
          type: integer
          nullable: true
          description: ID de la frecuencia (si aplica)
          example: null
        cantidad_cuotas_totales:
          type: integer
          minimum: 1
          maximum: 60
          nullable: true
          description: Cantidad total de cuotas
          example: 6
        cantidad_cuotas_pagadas:
          type: integer
          minimum: 0
          nullable: true
          description: Cantidad de cuotas pagadas
          example: 2
        tipo_pago_id:
          type: integer
          nullable: true
          description: ID del tipo de pago
          example: 3
        tarjeta_id:
          type: integer
          nullable: true
          description: ID de la tarjeta utilizada
          example: 2
        usuario_id:
          type: integer
          nullable: true
          description: ID del usuario
          example: 1
        tipo_origen:
          type: string
          enum: [unico, recurrente, debito_automatico, compra]
          description: Tipo de origen del gasto
          example: "unico"
        id_origen:
          type: integer
          description: ID en la tabla de origen
          example: 456
        createdAt:
          type: string
          format: date-time
          description: Fecha de creación
        updatedAt:
          type: string
          format: date-time
          description: Fecha de última actualización
        categoria:
          $ref: '#/components/schemas/Categoria'
        importancia:
          $ref: '#/components/schemas/Importancia'
        tipoPago:
          $ref: '#/components/schemas/TipoPago'
        tarjeta:
          $ref: '#/components/schemas/Tarjeta'
        frecuencia:
          $ref: '#/components/schemas/Frecuencia'

    GastoUnico:
      type: object
      properties:
        id:
          type: integer
          description: ID único del gasto único
          example: 789
        descripcion:
          type: string
          minLength: 3
          maxLength: 255
          description: Descripción del gasto
          example: "Compra única de equipo"
        monto:
          type: number
          minimum: 0.01
          description: Monto del gasto (en la moneda especificada en moneda_origen)
          example: 2500.75
        fecha:
          type: string
          format: date
          description: Fecha del gasto (no puede ser futura)
          example: "2024-01-15"
        categoria_gasto_id:
          type: integer
          description: ID de la categoría del gasto
          example: 8
        importancia_gasto_id:
          type: integer
          description: ID de la importancia del gasto
          example: 1
        tipo_pago_id:
          type: integer
          description: ID del tipo de pago
          example: 3
        tarjeta_id:
          type: integer
          nullable: true
          description: ID de la tarjeta (opcional)
          example: 1
        procesado:
          type: boolean
          description: Indica si ya fue procesado para generar gasto real
          example: true
        moneda_origen:
          type: string
          enum: [ARS, USD]
          default: ARS
          description: Moneda en la que se ingresó el monto originalmente
          example: "ARS"
        monto_ars:
          type: number
          description: Monto calculado en pesos argentinos (calculado automáticamente)
          example: 2500.75
        monto_usd:
          type: number
          nullable: true
          description: Monto calculado en dólares estadounidenses (calculado automáticamente)
          example: 2.50
        tipo_cambio_usado:
          type: number
          nullable: true
          description: Tipo de cambio usado para la conversión (snapshot histórico)
          example: 1000.00
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        categoria:
          $ref: '#/components/schemas/Categoria'
        importancia:
          $ref: '#/components/schemas/Importancia'
        tipoPago:
          $ref: '#/components/schemas/TipoPago'
        tarjeta:
          $ref: '#/components/schemas/Tarjeta'

    Compra:
      type: object
      properties:
        id:
          type: integer
          description: ID único de la compra
          example: 456
        descripcion:
          type: string
          minLength: 3
          maxLength: 255
          description: Descripción de la compra
          example: "Notebook nueva en 12 cuotas"
        monto_total:
          type: number
          minimum: 0.01
          description: Monto total de la compra (en la moneda especificada en moneda_origen)
          example: 120000.00
        fecha_compra:
          type: string
          format: date
          description: Fecha de la compra
          example: "2024-01-15"
        cantidad_cuotas:
          type: integer
          minimum: 1
          maximum: 60
          default: 1
          description: Cantidad de cuotas
          example: 12
        pendiente_cuotas:
          type: boolean
          description: Si hay cuotas pendientes de procesar
          example: true
        categoria_gasto_id:
          type: integer
          description: ID de la categoría
        importancia_gasto_id:
          type: integer
          description: ID de la importancia
        tipo_pago_id:
          type: integer
          description: ID del tipo de pago
        tarjeta_id:
          type: integer
          nullable: true
          description: ID de la tarjeta (opcional)
        moneda_origen:
          type: string
          enum: [ARS, USD]
          default: ARS
          description: Moneda en la que se ingresó el monto total originalmente
          example: "ARS"
        monto_total_ars:
          type: number
          description: Monto total calculado en pesos argentinos (calculado automáticamente)
          example: 120000.00
        monto_total_usd:
          type: number
          nullable: true
          description: Monto total calculado en dólares (calculado automáticamente)
          example: 120.00
        tipo_cambio_usado:
          type: number
          nullable: true
          description: Tipo de cambio usado para la conversión (snapshot histórico)
          example: 1000.00
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        categoria:
          $ref: '#/components/schemas/Categoria'
        importancia:
          $ref: '#/components/schemas/Importancia'
        tipoPago:
          $ref: '#/components/schemas/TipoPago'
        tarjeta:
          $ref: '#/components/schemas/Tarjeta'

    GastoRecurrente:
      type: object
      properties:
        id:
          type: integer
          description: ID único del gasto recurrente
          example: 321
        descripcion:
          type: string
          minLength: 3
          maxLength: 255
          description: Descripción del gasto
          example: "Alquiler mensual"
        monto:
          type: number
          minimum: 0.01
          description: Monto del gasto (en la moneda especificada en moneda_origen)
          example: 50000.00
        dia_de_pago:
          type: integer
          minimum: 1
          maximum: 31
          description: Día del mes para el pago
          example: 15
        mes_de_pago:
          type: integer
          minimum: 1
          maximum: 12
          nullable: true
          description: Mes específico para gastos anuales
          example: null
        activo:
          type: boolean
          description: Si el gasto está activo
          example: true
        ultima_fecha_generado:
          type: string
          format: date
          nullable: true
          description: Última fecha que se generó un gasto
        fecha_inicio:
          type: string
          format: date
          nullable: true
          description: Fecha a partir de la cual se generan gastos. Si no se envía al crear, se usa la fecha actual como default.
        categoria_gasto_id:
          type: integer
        importancia_gasto_id:
          type: integer
        tipo_pago_id:
          type: integer
        tarjeta_id:
          type: integer
          nullable: true
        frecuencia_gasto_id:
          type: integer
          description: ID de la frecuencia (mensual, anual, etc.)
        moneda_origen:
          type: string
          enum: [ARS, USD]
          default: ARS
          description: Moneda en la que se ingresó el monto originalmente
          example: "ARS"
        monto_ars:
          type: number
          description: Monto calculado en pesos argentinos (calculado automáticamente)
          example: 50000.00
        monto_usd:
          type: number
          nullable: true
          description: Monto calculado en dólares (calculado automáticamente)
          example: 50.00
        tipo_cambio_referencia:
          type: number
          nullable: true
          description: Tipo de cambio de referencia usado (se actualiza diariamente)
          example: 1000.00
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        categoria:
          $ref: '#/components/schemas/Categoria'
        importancia:
          $ref: '#/components/schemas/Importancia'
        tipoPago:
          $ref: '#/components/schemas/TipoPago'
        tarjeta:
          $ref: '#/components/schemas/Tarjeta'
        frecuencia:
          $ref: '#/components/schemas/Frecuencia'

    DebitoAutomatico:
      type: object
      properties:
        id:
          type: integer
          description: ID único del débito automático
          example: 654
        descripcion:
          type: string
          minLength: 3
          maxLength: 255
          description: Descripción del débito
          example: "Suscripción Netflix"
        monto:
          type: number
          minimum: 0.01
          description: Monto del débito (en la moneda especificada en moneda_origen)
          example: 1200.00
        dia_de_pago:
          type: integer
          minimum: 1
          maximum: 31
          nullable: true
          description: Día del mes para el débito. Null si usa_vencimiento_tarjeta es true.
          example: 5
        usa_vencimiento_tarjeta:
          type: boolean
          default: false
          description: Si es true, usa el día de vencimiento de la tarjeta de crédito en lugar de dia_de_pago
          example: false
        activo:
          type: boolean
          description: Si el débito está activo
          example: true
        ultima_fecha_generado:
          type: string
          format: date
          nullable: true
          description: Última fecha que se generó un gasto
        fecha_inicio:
          type: string
          format: date
          nullable: true
          description: Fecha a partir de la cual se generan débitos. Si no se envía al crear, se usa la fecha actual como default.
        categoria_gasto_id:
          type: integer
        importancia_gasto_id:
          type: integer
        tipo_pago_id:
          type: integer
        tarjeta_id:
          type: integer
          nullable: true
        frecuencia_gasto_id:
          type: integer
          description: ID de la frecuencia
        moneda_origen:
          type: string
          enum: [ARS, USD]
          default: ARS
          description: Moneda en la que se ingresó el monto originalmente
          example: "ARS"
        monto_ars:
          type: number
          description: Monto calculado en pesos argentinos (calculado automáticamente)
          example: 1200.00
        monto_usd:
          type: number
          nullable: true
          description: Monto calculado en dólares (calculado automáticamente)
          example: 1.20
        tipo_cambio_referencia:
          type: number
          nullable: true
          description: Tipo de cambio de referencia usado (se actualiza diariamente)
          example: 1000.00
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        categoria:
          $ref: '#/components/schemas/Categoria'
        importancia:
          $ref: '#/components/schemas/Importancia'
        tipoPago:
          $ref: '#/components/schemas/TipoPago'
        tarjeta:
          $ref: '#/components/schemas/Tarjeta'
        frecuencia:
          $ref: '#/components/schemas/Frecuencia'

    Categoria:
      type: object
      properties:
        id:
          type: integer
        nombre_categoria:
          type: string

    Importancia:
      type: object
      properties:
        id:
          type: integer
        nombre_importancia:
          type: string

    TipoPago:
      type: object
      properties:
        id:
          type: integer
        nombre:
          type: string
        permite_cuotas:
          type: boolean

    Tarjeta:
      type: object
      properties:
        id:
          type: integer
          description: ID único de la tarjeta
          example: 1
        nombre:
          type: string
          minLength: 2
          maxLength: 100
          description: Nombre descriptivo de la tarjeta
          example: "Visa Platinum ICBC"
        tipo:
          type: string
          enum: [debito, credito, virtual]
          description: Tipo de tarjeta
          example: "credito"
        banco:
          type: string
          minLength: 2
          maxLength: 100
          description: Nombre del banco emisor
          example: "ICBC"
        ultimos_4_digitos:
          type: string
          minLength: 4
          maxLength: 4
          pattern: '^\d{4}$'
          nullable: true
          description: Últimos 4 dígitos de la tarjeta para identificación
          example: "1234"
        dia_mes_cierre:
          type: integer
          minimum: 1
          maximum: 31
          nullable: true
          description: Día del mes de cierre (solo tarjetas de crédito)
          example: 20
        dia_mes_vencimiento:
          type: integer
          minimum: 1
          maximum: 31
          nullable: true
          description: Día del mes de vencimiento (solo tarjetas de crédito)
          example: 10
        permite_cuotas:
          type: boolean
          description: Indica si la tarjeta permite compras en cuotas
          example: true
        usuario_id:
          type: integer
          description: ID del usuario propietario
          example: 1

    TarjetaInput:
      type: object
      required: [nombre, tipo, banco]
      properties:
        nombre:
          type: string
          minLength: 2
          maxLength: 100
          description: Nombre descriptivo de la tarjeta
          example: "Visa Platinum ICBC"
        tipo:
          type: string
          enum: [debito, credito, virtual]
          description: Tipo de tarjeta
          example: "credito"
        banco:
          type: string
          minLength: 2
          maxLength: 100
          description: Nombre del banco emisor
          example: "ICBC"
        ultimos_4_digitos:
          type: string
          minLength: 4
          maxLength: 4
          pattern: '^\d{4}$'
          description: Últimos 4 dígitos de la tarjeta para identificación (opcional)
          example: "1234"
        dia_mes_cierre:
          type: integer
          minimum: 1
          maximum: 31
          description: Día del mes de cierre (requerido para tarjetas de crédito)
          example: 20
        dia_mes_vencimiento:
          type: integer
          minimum: 1
          maximum: 31
          description: Día del mes de vencimiento (requerido para tarjetas de crédito)
          example: 10
        permite_cuotas:
          type: boolean
          description: Permite compras en cuotas (se auto-configura según tipo)
          example: true

    TarjetaStats:
      type: object
      properties:
        estadisticas:
          type: object
          properties:
            total:
              type: integer
              description: Total de tarjetas del usuario
              example: 5
            credito:
              type: integer
              description: Cantidad de tarjetas de crédito
              example: 3
            debito:
              type: integer
              description: Cantidad de tarjetas de débito
              example: 2
            virtual:
              type: integer
              description: Cantidad de tarjetas virtuales
              example: 0
        usuario_id:
          type: integer
          description: ID del usuario
          example: 1

    TarjetaUsage:
      type: object
      properties:
        tarjeta:
          type: object
          properties:
            id:
              type: integer
              example: 1
            nombre:
              type: string
              example: "Visa Platinum ICBC"
            tipo:
              type: string
              example: "credito"
        inUse:
          type: boolean
          description: Indica si la tarjeta está siendo utilizada
          example: false
        usage:
          type: object
          properties:
            gastos:
              type: integer
              description: Cantidad de gastos que usan esta tarjeta
              example: 5
            compras:
              type: integer
              description: Cantidad de compras que usan esta tarjeta
              example: 2
            total:
              type: integer
              description: Total de registros que usan esta tarjeta
              example: 7

    Frecuencia:
      type: object
      properties:
        id:
          type: integer
        nombre:
          type: string

    GastosSummary:
      type: object
      properties:
        periodo:
          type: object
          properties:
            desde:
              type: string
              format: date
            hasta:
              type: string
              format: date
        total_ars:
          type: number
          description: Total en pesos argentinos
        total_usd:
          type: number
          description: Total en dólares estadounidenses
        cantidad_gastos:
          type: integer
          description: Cantidad total de gastos
        por_categoria:
          type: object
          additionalProperties:
            type: object
            properties:
              total_ars:
                type: number
              total_usd:
                type: number
              cantidad:
                type: integer
        por_importancia:
          type: object
          additionalProperties:
            type: object
            properties:
              total_ars:
                type: number
              total_usd:
                type: number
              cantidad:
                type: integer
        por_tipo_pago:
          type: object
          additionalProperties:
            type: object
            properties:
              total_ars:
                type: number
              total_usd:
                type: number
              cantidad:
                type: integer

    GenerateResult:
      type: object
      properties:
        summary:
          type: object
          properties:
            total_generated:
              type: integer
            total_errors:
              type: integer
            breakdown:
              type: object
              properties:
                recurrentes:
                  type: integer
                debitos:
                  type: integer
                compras:
                  type: integer
                unicos:
                  type: integer
        details:
          type: object
          properties:
            success:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                  id:
                    type: integer
            errors:
              type: array
              items:
                type: object

    # Authentication Schemas
    User:
      type: object
      properties:
        id:
          type: integer
          description: ID único del usuario
          example: 1
        nombre:
          type: string
          description: Nombre completo del usuario
          example: "Juan Pérez"
        email:
          type: string
          format: email
          description: Email del usuario
          example: "juan@example.com"
      required:
        - id
        - nombre
        - email

    RegisterRequest:
      type: object
      properties:
        nombre:
          type: string
          minLength: 2
          maxLength: 100
          description: Nombre completo del usuario
          example: "Juan Pérez"
        email:
          type: string
          format: email
          description: Email del usuario
          example: "juan@example.com"
        password:
          type: string
          minLength: 6
          pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)"
          description: "Contraseña (mín 6 chars, 1 mayúscula, 1 minúscula, 1 número)"
          example: "Password123"
      required:
        - nombre
        - email
        - password

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: Email del usuario
          example: "juan@example.com"
        password:
          type: string
          description: Contraseña del usuario
          example: "Password123"
      required:
        - email
        - password

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Login exitoso"
        data:
          type: object
          properties:
            token:
              type: string
              description: JWT token para autenticación
              example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
            user:
              $ref: '#/components/schemas/User'

    UpdateProfileRequest:
      type: object
      properties:
        nombre:
          type: string
          minLength: 2
          maxLength: 100
          description: Nuevo nombre del usuario
          example: "Juan Carlos Pérez"
        email:
          type: string
          format: email
          description: Nuevo email del usuario
          example: "juan.carlos@example.com"

    ChangePasswordRequest:
      type: object
      properties:
        currentPassword:
          type: string
          description: Contraseña actual
          example: "OldPassword123"
        newPassword:
          type: string
          minLength: 6
          pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)"
          description: "Nueva contraseña (mín 6 chars, 1 mayúscula, 1 minúscula, 1 número)"
          example: "NewPassword123"
      required:
        - currentPassword
        - newPassword

    AuthSuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operación exitosa"
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'

    AuthErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Error de autenticación"
        error:
          type: string
          enum:
            - MISSING_TOKEN
            - INVALID_TOKEN
            - INVALID_CREDENTIALS
            - EMAIL_ALREADY_EXISTS
            - INVALID_CURRENT_PASSWORD
            - INSUFFICIENT_PERMISSIONS
          example: "INVALID_CREDENTIALS"

    # Multi-Currency Schemas
    TipoCambio:
      type: object
      properties:
        id:
          type: integer
          description: ID único del registro de tipo de cambio
          example: 1
        fecha:
          type: string
          format: date
          description: Fecha del tipo de cambio
          example: "2024-01-15"
        valor_compra:
          type: number
          format: decimal
          description: Valor de compra del dólar (lo que pagas para comprar USD)
          example: 995.50
        valor_venta:
          type: number
          format: decimal
          description: Valor de venta del dólar (lo que recibes al vender USD)
          example: 1005.50
        fuente:
          type: string
          description: Fuente de donde se obtuvo el tipo de cambio
          example: "BCRA"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

  responses:
    Unauthorized:
      description: Token de autenticación inválido o ausente
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AuthErrorResponse'
          example:
            success: false
            message: "Token de acceso requerido"
            error: "MISSING_TOKEN"

    ValidationError:
      description: Error de validación en los datos de entrada
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'

  parameters:
    GastoIdParam:
      name: id
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
      description: ID del gasto
      example: 123

    PaginationLimit:
      name: limit
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 1000
      description: Número máximo de resultados a devolver
      example: 20

    PaginationOffset:
      name: offset
      in: query
      schema:
        type: integer
        minimum: 0
      description: Número de resultados a omitir
      example: 40

    OrderBy:
      name: orderBy
      in: query
      schema:
        type: string
        enum: [fecha, monto_ars, monto_usd, descripcion, createdAt, updatedAt]
        default: fecha
      description: Campo por el cual ordenar
      example: fecha

    OrderDirection:
      name: orderDirection
      in: query
      schema:
        type: string
        enum: [ASC, DESC]
        default: DESC
      description: Dirección del ordenamiento
      example: DESC

paths:
  # AUTHENTICATION ENDPOINTS
  /auth/register:
    post:
      tags:
        - auth
      summary: Registrar nuevo usuario
      description: |
        Registra un nuevo usuario en el sistema.

        **Validaciones:**
        - Email único en el sistema
        - Contraseña debe cumplir con política de seguridad
        - Nombre debe tener al menos 2 caracteres
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Usuario registrado exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "Usuario registrado exitosamente"
                      data:
                        type: object
                        properties:
                          user:
                            $ref: '#/components/schemas/User'
        '400':
          description: Error de validación
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ValidationError'
                  - $ref: '#/components/schemas/AuthErrorResponse'
              examples:
                validation_error:
                  summary: Error de validación de datos
                  value:
                    success: false
                    message: "Datos de registro inválidos"
                    errors: ["La contraseña debe tener al menos 6 caracteres"]
                email_exists:
                  summary: Email ya registrado
                  value:
                    success: false
                    message: "Email ya está registrado"
                    error: "EMAIL_ALREADY_EXISTS"
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'

  /auth/login:
    post:
      tags:
        - auth
      summary: Iniciar sesión
      description: |
        Autentica un usuario y devuelve un JWT token para acceso a endpoints protegidos.

        **Uso del token:**
        - Incluir en header `Authorization: Bearer <token>`
        - Token válido por 7 días (configurable)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login exitoso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Error de validación en datos de entrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              example:
                success: false
                message: "Datos de login inválidos"
                errors: ["Debe ser un email válido"]
        '401':
          description: Credenciales inválidas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthErrorResponse'
              example:
                success: false
                message: "Email o contraseña incorrectos"
                error: "INVALID_CREDENTIALS"
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'

  /auth/profile:
    get:
      tags:
        - auth
      summary: Obtener perfil del usuario
      description: Obtiene la información del perfil del usuario autenticado
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Perfil obtenido exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
              example:
                success: true
                message: "Perfil obtenido exitosamente"
                data:
                  user:
                    id: 1
                    nombre: "Juan Pérez"
                    email: "juan@example.com"
        '401':
          description: Token inválido o ausente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthErrorResponse'
              example:
                success: false
                message: "Token de acceso requerido"
                error: "MISSING_TOKEN"
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'

    put:
      tags:
        - auth
      summary: Actualizar perfil del usuario
      description: |
        Actualiza la información del perfil del usuario autenticado.
        Solo se actualizan los campos proporcionados.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
      responses:
        '200':
          description: Perfil actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
              example:
                success: true
                message: "Perfil actualizado exitosamente"
                data:
                  user:
                    id: 1
                    nombre: "Juan Carlos Pérez"
                    email: "juan.carlos@example.com"
        '400':
          description: Error de validación o email ya en uso
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ValidationError'
                  - $ref: '#/components/schemas/AuthErrorResponse'
              examples:
                validation_error:
                  summary: Error de validación
                  value:
                    success: false
                    message: "Datos inválidos"
                    errors: ["El nombre debe tener al menos 2 caracteres"]
                email_exists:
                  summary: Email ya en uso
                  value:
                    success: false
                    message: "Email ya está en uso"
                    error: "EMAIL_ALREADY_EXISTS"
        '401':
          description: Token inválido o ausente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'

  /auth/change-password:
    post:
      tags:
        - auth
      summary: Cambiar contraseña
      description: |
        Cambia la contraseña del usuario autenticado.
        Requiere proporcionar la contraseña actual para validación.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '200':
          description: Contraseña actualizada exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "Contraseña actualizada exitosamente"
        '400':
          description: Error de validación o contraseña actual incorrecta
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ValidationError'
                  - $ref: '#/components/schemas/AuthErrorResponse'
              examples:
                validation_error:
                  summary: Nueva contraseña inválida
                  value:
                    success: false
                    message: "Datos inválidos"
                    errors: ["La contraseña debe tener al menos 6 caracteres"]
                invalid_current:
                  summary: Contraseña actual incorrecta
                  value:
                    success: false
                    message: "Password actual incorrecto"
                    error: "INVALID_CURRENT_PASSWORD"
        '401':
          description: Token inválido o ausente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'

  /auth/logout:
    post:
      tags:
        - auth
      summary: Cerrar sesión
      description: |
        Cierra la sesión del usuario autenticado.

        **Nota:** En JWT stateless, el logout es principalmente informativo.
        El token seguirá siendo válido hasta su expiración.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Sesión cerrada exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "Sesión cerrada exitosamente"
        '401':
          description: Token inválido o ausente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'
  /gastos/all:
    get:
      tags:
        - gastos
      summary: Obtener todos los gastos
      description: Retorna todos los gastos sin filtros ni paginación
      responses:
        '200':
          description: Lista completa de gastos
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Gasto'
              example:
                success: true
                data: []
                meta:
                  total: 150
                  type: "collection"

  /gastos:
    get:
      tags:
        - gastos
      summary: Obtener gastos con filtros
      description: |
        Obtiene gastos aplicando filtros opcionales. 
        
        **Comportamiento de paginación:**
        - Sin `limit`: Devuelve todos los resultados filtrados
        - Con `limit`: Devuelve respuesta paginada con metadata de navegación
      parameters:
        - name: categoria_gasto_id
          in: query
          schema:
            type: integer
          description: Filtrar por categoría de gasto
        - name: importancia_gasto_id
          in: query
          schema:
            type: integer
          description: Filtrar por importancia
        - name: tipo_pago_id
          in: query
          schema:
            type: integer
          description: Filtrar por tipo de pago
        - name: tarjeta_id
          in: query
          schema:
            type: integer
          description: Filtrar por tarjeta
        - name: fecha_desde
          in: query
          schema:
            type: string
            format: date
          description: Fecha de inicio del rango
          example: "2024-01-01"
        - name: fecha_hasta
          in: query
          schema:
            type: string
            format: date
          description: Fecha de fin del rango
          example: "2024-12-31"
        - name: monto_min_ars
          in: query
          schema:
            type: number
          description: Monto mínimo en ARS
        - name: monto_max_ars
          in: query
          schema:
            type: number
          description: Monto máximo en ARS
        - name: monto_min_usd
          in: query
          schema:
            type: number
          description: Monto mínimo en USD
        - name: monto_max_usd
          in: query
          schema:
            type: number
          description: Monto máximo en USD
        - name: tipo_origen
          in: query
          schema:
            type: string
            enum: [unico, recurrente, debito_automatico, compra]
          description: Filtrar por tipo de origen del gasto
          example: "unico"
        - name: id_origen
          in: query
          schema:
            type: integer
            minimum: 1
          description: Filtrar por ID del registro origen que generó este gasto
          example: 123
        - $ref: '#/components/parameters/PaginationLimit'
        - $ref: '#/components/parameters/PaginationOffset'
        - $ref: '#/components/parameters/OrderBy'
        - $ref: '#/components/parameters/OrderDirection'
      responses:
        '200':
          description: Lista de gastos filtrados
          content:
            application/json:
              schema:
                anyOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            type: array
                            items:
                              $ref: '#/components/schemas/Gasto'
                        description: Respuesta sin paginación
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            type: array
                            items:
                              $ref: '#/components/schemas/Gasto'
                          meta:
                            type: object
                            properties:
                              total:
                                type: integer
                              type:
                                type: string
                                example: "collection"
                              pagination:
                                $ref: '#/components/schemas/Pagination'
                        description: Respuesta con paginación
        '400':
          description: Error de validación en parámetros
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

    post:
      tags:
        - gastos
      summary: Crear nuevo gasto
      description: Crea un nuevo gasto en la tabla principal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - fecha
                - descripcion
                - categoria_gasto_id
                - importancia_gasto_id
                - tipo_origen
                - id_origen
              properties:
                fecha:
                  type: string
                  format: date
                  description: Fecha del gasto (no puede ser futura)
                monto_ars:
                  type: number
                  minimum: 0.01
                  description: Monto en pesos argentinos
                monto_usd:
                  type: number
                  minimum: 0.01
                  description: Monto en dólares estadounidenses
                descripcion:
                  type: string
                  minLength: 3
                  maxLength: 255
                categoria_gasto_id:
                  type: integer
                  minimum: 1
                importancia_gasto_id:
                  type: integer
                  minimum: 1
                frecuencia_gasto_id:
                  type: integer
                  minimum: 1
                  nullable: true
                cantidad_cuotas_totales:
                  type: integer
                  minimum: 1
                  maximum: 60
                cantidad_cuotas_pagadas:
                  type: integer
                  minimum: 0
                tipo_pago_id:
                  type: integer
                  minimum: 1
                tarjeta_id:
                  type: integer
                  minimum: 1
                  nullable: true
                usuario_id:
                  type: integer
                  minimum: 1
                tipo_origen:
                  type: string
                  enum: [unico, recurrente, debito_automatico, compra]
                id_origen:
                  type: integer
                  minimum: 1
              description: |
                **Validaciones:**
                - Al menos `monto_ars` o `monto_usd` debe proporcionarse
                - Todos los IDs de referencia deben existir
                - `cantidad_cuotas_pagadas` ≤ `cantidad_cuotas_totales`
            example:
              fecha: "2024-01-15"
              monto_ars: 1500.50
              descripcion: "Almuerzo en restaurante"
              categoria_gasto_id: 5
              importancia_gasto_id: 2
              tipo_pago_id: 3
              tarjeta_id: 2
              tipo_origen: "unico"
              id_origen: 123
      responses:
        '201':
          description: Gasto creado exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Gasto'
        '400':
          description: Error de validación
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /gastos/{id}:
    get:
      tags:
        - gastos
      summary: Obtener gasto por ID
      description: Obtiene un gasto específico con todas sus relaciones
      parameters:
        - $ref: '#/components/parameters/GastoIdParam'
      responses:
        '200':
          description: Gasto encontrado
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Gasto'
        '404':
          description: Gasto no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'
              example:
                success: false
                error: "Gasto no encontrado"
                timestamp: "2025-09-10T00:35:00.434Z"

    put:
      tags:
        - gastos
      summary: Actualizar gasto
      description: Actualiza un gasto existente
      parameters:
        - $ref: '#/components/parameters/GastoIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fecha:
                  type: string
                  format: date
                monto_ars:
                  type: number
                  minimum: 0.01
                monto_usd:
                  type: number
                  minimum: 0.01
                descripcion:
                  type: string
                  minLength: 3
                  maxLength: 255
                categoria_gasto_id:
                  type: integer
                  minimum: 1
                importancia_gasto_id:
                  type: integer
                  minimum: 1
                frecuencia_gasto_id:
                  type: integer
                  minimum: 1
                  nullable: true
                cantidad_cuotas_totales:
                  type: integer
                  minimum: 1
                  maximum: 60
                cantidad_cuotas_pagadas:
                  type: integer
                  minimum: 0
                tipo_pago_id:
                  type: integer
                  minimum: 1
                tarjeta_id:
                  type: integer
                  minimum: 1
                  nullable: true
                usuario_id:
                  type: integer
                  minimum: 1
                tipo_origen:
                  type: string
                  enum: [unico, recurrente, debito_automatico, compra]
                id_origen:
                  type: integer
                  minimum: 1
      responses:
        '200':
          description: Gasto actualizado exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Gasto'
        '400':
          description: Error de validación
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '404':
          description: Gasto no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'

    delete:
      tags:
        - gastos
      summary: Eliminar gasto
      description: Elimina un gasto existente
      parameters:
        - $ref: '#/components/parameters/GastoIdParam'
      responses:
        '200':
          description: Gasto eliminado exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Gasto eliminado correctamente"
        '404':
          description: Gasto no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'

  /gastos/search:
    post:
      tags:
        - gastos
      summary: Búsqueda avanzada de gastos
      description: |
        Realiza búsquedas complejas con filtros avanzados y paginación.
        Ideal para formularios de búsqueda con múltiples criterios.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                categoria_gasto_id:
                  type: integer
                  description: Filtrar por categoría
                importancia_gasto_id:
                  type: integer
                  description: Filtrar por importancia
                frecuencia_gasto_id:
                  type: integer
                  description: Filtrar por frecuencia
                tipo_pago_id:
                  type: integer
                  description: Filtrar por tipo de pago
                tarjeta_id:
                  type: integer
                  description: Filtrar por tarjeta
                fecha_desde:
                  type: string
                  format: date
                  description: Fecha de inicio
                fecha_hasta:
                  type: string
                  format: date
                  description: Fecha de fin
                monto_min_ars:
                  type: number
                  description: Monto mínimo en ARS
                monto_max_ars:
                  type: number
                  description: Monto máximo en ARS
                monto_min_usd:
                  type: number
                  description: Monto mínimo en USD
                monto_max_usd:
                  type: number
                  description: Monto máximo en USD
                tipo_origen:
                  type: string
                  enum: [unico, recurrente, debito_automatico, compra]
                  description: Filtrar por tipo de origen del gasto
                  example: "unico"
                id_origen:
                  type: integer
                  minimum: 1
                  description: Filtrar por ID del registro origen que generó este gasto
                  example: 123
                limit:
                  type: integer
                  minimum: 1
                  maximum: 1000
                  default: 100
                  description: Elementos por página
                offset:
                  type: integer
                  minimum: 0
                  default: 0
                  description: Elementos a saltar
                orderBy:
                  type: string
                  enum: [fecha, monto_ars, monto_usd, descripcion, createdAt, updatedAt]
                  default: fecha
                orderDirection:
                  type: string
                  enum: [ASC, DESC]
                  default: DESC
            example:
              categoria_gasto_id: 5
              tipo_origen: "unico"
              id_origen: 123
              fecha_desde: "2024-01-01"
              fecha_hasta: "2024-12-31"
              monto_min_ars: 100
              limit: 20
              offset: 0
              orderBy: "fecha"
              orderDirection: "DESC"
      responses:
        '200':
          description: Resultados de búsqueda
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Gasto'
                      meta:
                        type: object
                        properties:
                          total:
                            type: integer
                          type:
                            type: string
                            example: "collection"
                          pagination:
                            $ref: '#/components/schemas/Pagination'

  /gastos/summary:
    get:
      tags:
        - gastos
      summary: Obtener resumen de gastos
      description: |
        Obtiene estadísticas agregadas de gastos por período.
        Si no se especifican fechas, usa el mes actual por defecto.
      parameters:
        - name: fecha_desde
          in: query
          schema:
            type: string
            format: date
          description: Fecha de inicio del período
          example: "2024-01-01"
        - name: fecha_hasta
          in: query
          schema:
            type: string
            format: date
          description: Fecha de fin del período
          example: "2024-12-31"
      responses:
        '200':
          description: Resumen estadístico de gastos
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/GastosSummary'
              example:
                success: true
                data:
                  periodo:
                    desde: "2025-09-01"
                    hasta: "2025-09-30"
                  total_ars: 3317375.34
                  total_usd: 0
                  cantidad_gastos: 20
                  por_categoria:
                    "Entretenimiento":
                      total_ars: 1302398.16
                      total_usd: 0
                      cantidad: 7
                  por_importancia:
                    "Necesario":
                      total_ars: 101700
                      total_usd: 0
                      cantidad: 6
                  por_tipo_pago:
                    "Efectivo":
                      total_ars: 287764.08
                      total_usd: 0
                      cantidad: 10

  /gastos/generate:
    get:
      tags:
        - gastos
      summary: Generar gastos pendientes
      description: |
        Ejecuta el proceso de generación automática de gastos pendientes.
        Procesa gastos recurrentes, débitos automáticos, compras y gastos únicos.
      responses:
        '200':
          description: Proceso de generación completado
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/GenerateResult'
                      message:
                        type: string
                        example: "Generación de gastos completada exitosamente"
        '500':
          description: Error en el proceso de generación
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'

  # GASTOS ÚNICOS
  /gastos-unicos:
    get:
      tags:
        - gastos-unicos
      summary: Obtener gastos únicos con filtros
      description: |
        Obtiene gastos únicos aplicando filtros opcionales con paginación inteligente.
        
        **Comportamiento de paginación:**
        - Sin `limit`: Devuelve todos los resultados filtrados
        - Con `limit`: Devuelve respuesta paginada con metadata de navegación
      parameters:
        - name: categoria_gasto_id
          in: query
          schema:
            type: integer
          description: Filtrar por categoría de gasto
        - name: importancia_gasto_id
          in: query
          schema:
            type: integer
          description: Filtrar por importancia
        - name: tipo_pago_id
          in: query
          schema:
            type: integer
          description: Filtrar por tipo de pago
        - name: tarjeta_id
          in: query
          schema:
            type: integer
          description: Filtrar por tarjeta
        - name: fecha_desde
          in: query
          schema:
            type: string
            format: date
          description: Fecha de inicio del rango
        - name: fecha_hasta
          in: query
          schema:
            type: string
            format: date
          description: Fecha de fin del rango
        - name: monto_min
          in: query
          schema:
            type: number
          description: Monto mínimo
        - name: monto_max
          in: query
          schema:
            type: number
          description: Monto máximo
        - name: procesado
          in: query
          schema:
            type: boolean
          description: Filtrar por estado procesado
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 1000
          description: Número máximo de resultados (activa paginación)
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Número de resultados a omitir
        - name: orderBy
          in: query
          schema:
            type: string
            enum: [fecha, monto, descripcion, createdAt, updatedAt]
            default: fecha
          description: Campo por el cual ordenar
        - name: orderDirection
          in: query
          schema:
            type: string
            enum: [ASC, DESC]
            default: DESC
          description: Dirección del ordenamiento
      responses:
        '200':
          description: Lista de gastos únicos
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/GastoUnico'

    post:
      tags:
        - gastos-unicos
      summary: Crear gasto único
      description: |
        Crea un nuevo gasto único. Al crearse, se programa automáticamente
        para generar un gasto real en la tabla principal.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - descripcion
                - monto
                - fecha
                - categoria_gasto_id
                - importancia_gasto_id
                - tipo_pago_id
              properties:
                descripcion:
                  type: string
                  minLength: 3
                  maxLength: 255
                  example: "Compra de equipamiento"
                monto:
                  type: number
                  minimum: 0.01
                  example: 2500.50
                fecha:
                  type: string
                  format: date
                  description: Fecha del gasto (no puede ser futura)
                  example: "2024-01-15"
                categoria_gasto_id:
                  type: integer
                  minimum: 1
                  example: 8
                importancia_gasto_id:
                  type: integer
                  minimum: 1
                  example: 2
                tipo_pago_id:
                  type: integer
                  minimum: 1
                  example: 3
                tarjeta_id:
                  type: integer
                  minimum: 1
                  nullable: true
                  description: Requerido para pagos con tarjeta
                  example: 2
            example:
              descripcion: "Compra de equipamiento"
              monto: 2500.50
              fecha: "2024-01-15"
              categoria_gasto_id: 8
              importancia_gasto_id: 2
              tipo_pago_id: 3
              tarjeta_id: 2
      responses:
        '201':
          description: Gasto único creado exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/GastoUnico'
        '400':
          description: Error de validación
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /gastos-unicos/{id}:
    get:
      tags:
        - gastos-unicos
      summary: Obtener gasto único por ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del gasto único
      responses:
        '200':
          description: Gasto único encontrado
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/GastoUnico'
        '404':
          description: Gasto único no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'

    put:
      tags:
        - gastos-unicos
      summary: Actualizar gasto único
      description: |
        Actualiza un gasto único existente. Los cambios se reflejan
        también en el gasto real asociado si ya fue generado.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del gasto único
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                descripcion:
                  type: string
                  minLength: 3
                  maxLength: 255
                monto:
                  type: number
                  minimum: 0.01
                fecha:
                  type: string
                  format: date
                categoria_gasto_id:
                  type: integer
                  minimum: 1
                importancia_gasto_id:
                  type: integer
                  minimum: 1
                tipo_pago_id:
                  type: integer
                  minimum: 1
                tarjeta_id:
                  type: integer
                  minimum: 1
                  nullable: true
      responses:
        '200':
          description: Gasto único actualizado exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/GastoUnico'
        '400':
          description: Error de validación
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '404':
          description: Gasto único no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'

    delete:
      tags:
        - gastos-unicos
      summary: Eliminar gasto único
      description: |
        Elimina un gasto único. También elimina el gasto real asociado
        si ya fue generado, manteniendo la consistencia de datos.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del gasto único
      responses:
        '200':
          description: Gasto único eliminado exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Gasto único eliminado correctamente"
        '404':
          description: Gasto único no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'

  # COMPRAS
  /compras:
    get:
      tags:
        - compras
      summary: Obtener compras con filtros
      description: |
        Obtiene compras aplicando filtros opcionales con paginación inteligente.
        Incluye filtros específicos para compras en cuotas.
      parameters:
        - name: categoria_gasto_id
          in: query
          schema:
            type: integer
          description: Filtrar por categoría de gasto
        - name: importancia_gasto_id
          in: query
          schema:
            type: integer
          description: Filtrar por importancia
        - name: tipo_pago_id
          in: query
          schema:
            type: integer
          description: Filtrar por tipo de pago
        - name: tarjeta_id
          in: query
          schema:
            type: integer
          description: Filtrar por tarjeta
        - name: fecha_desde
          in: query
          schema:
            type: string
            format: date
          description: Fecha de inicio del rango de compras
        - name: fecha_hasta
          in: query
          schema:
            type: string
            format: date
          description: Fecha de fin del rango de compras
        - name: monto_min
          in: query
          schema:
            type: number
          description: Monto total mínimo
        - name: monto_max
          in: query
          schema:
            type: number
          description: Monto total máximo
        - name: pendiente_cuotas
          in: query
          schema:
            type: boolean
          description: Filtrar por estado de cuotas pendientes
        - name: cuotas_min
          in: query
          schema:
            type: integer
            minimum: 1
          description: Cantidad mínima de cuotas
        - name: cuotas_max
          in: query
          schema:
            type: integer
          description: Cantidad máxima de cuotas
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 1000
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: orderBy
          in: query
          schema:
            type: string
            enum: [fecha_compra, monto_total, descripcion, cantidad_cuotas, createdAt, updatedAt]
            default: fecha_compra
        - name: orderDirection
          in: query
          schema:
            type: string
            enum: [ASC, DESC]
            default: DESC
      responses:
        '200':
          description: Lista de compras
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Compra'

    post:
      tags:
        - compras
      summary: Crear compra
      description: |
        Crea una nueva compra en cuotas. Se genera automáticamente el primer gasto
        para compras de una sola cuota.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - descripcion
                - monto_total
                - fecha_compra
                - categoria_gasto_id
                - importancia_gasto_id
                - tipo_pago_id
              properties:
                descripcion:
                  type: string
                  minLength: 3
                  maxLength: 255
                monto_total:
                  type: number
                  minimum: 0.01
                fecha_compra:
                  type: string
                  format: date
                  description: No puede ser futura
                cantidad_cuotas:
                  type: integer
                  minimum: 1
                  maximum: 60
                  default: 1
                categoria_gasto_id:
                  type: integer
                  minimum: 1
                importancia_gasto_id:
                  type: integer
                  minimum: 1
                tipo_pago_id:
                  type: integer
                  minimum: 1
                tarjeta_id:
                  type: integer
                  minimum: 1
                  nullable: true
      responses:
        '201':
          description: Compra creada exitosamente

  /compras/{id}:
    get:
      tags:
        - compras
      summary: Obtener compra por ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Compra encontrada

    put:
      tags:
        - compras
      summary: Actualizar compra
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                descripcion:
                  type: string
                  minLength: 3
                  maxLength: 255
                monto_total:
                  type: number
                  minimum: 0.01
                fecha_compra:
                  type: string
                  format: date
                cantidad_cuotas:
                  type: integer
                  minimum: 1
                  maximum: 60
                categoria_gasto_id:
                  type: integer
                  minimum: 1
                importancia_gasto_id:
                  type: integer
                  minimum: 1
                tipo_pago_id:
                  type: integer
                  minimum: 1
                tarjeta_id:
                  type: integer
                  minimum: 1
                  nullable: true
      responses:
        '200':
          description: Compra actualizada exitosamente

    delete:
      tags:
        - compras
      summary: Eliminar compra
      description: |
        Elimina una compra. Los gastos ya generados se mantienen como histórico.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Compra eliminada exitosamente

  # GASTOS RECURRENTES
  /gastos-recurrentes:
    get:
      tags:
        - gastos-recurrentes
      summary: Obtener gastos recurrentes con filtros
      description: |
        Obtiene gastos recurrentes con filtros específicos para frecuencia y estado.
      parameters:
        - name: categoria_gasto_id
          in: query
          schema:
            type: integer
        - name: importancia_gasto_id
          in: query
          schema:
            type: integer
        - name: tipo_pago_id
          in: query
          schema:
            type: integer
        - name: tarjeta_id
          in: query
          schema:
            type: integer
        - name: frecuencia_gasto_id
          in: query
          schema:
            type: integer
          description: Filtrar por frecuencia (mensual, anual, etc.)
        - name: monto_min
          in: query
          schema:
            type: number
        - name: monto_max
          in: query
          schema:
            type: number
        - name: activo
          in: query
          schema:
            type: boolean
          description: Filtrar por estado activo/inactivo
        - name: dia_de_pago
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 31
          description: Día específico del mes
        - name: mes_de_pago
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 12
          description: Mes específico (para gastos anuales)
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 1000
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: orderBy
          in: query
          schema:
            type: string
            enum: [monto, descripcion, dia_de_pago, mes_de_pago, activo, createdAt, updatedAt]
            default: createdAt
        - name: orderDirection
          in: query
          schema:
            type: string
            enum: [ASC, DESC]
            default: DESC
      responses:
        '200':
          description: Lista de gastos recurrentes

    post:
      tags:
        - gastos-recurrentes
      summary: Crear gasto recurrente
      description: |
        Crea un nuevo gasto recurrente. Se procesará automáticamente según su frecuencia.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - descripcion
                - monto
                - dia_de_pago
                - categoria_gasto_id
                - importancia_gasto_id
                - tipo_pago_id
                - frecuencia_gasto_id
              properties:
                descripcion:
                  type: string
                  minLength: 3
                  maxLength: 255
                monto:
                  type: number
                  minimum: 0.01
                dia_de_pago:
                  type: integer
                  minimum: 1
                  maximum: 31
                mes_de_pago:
                  type: integer
                  minimum: 1
                  maximum: 12
                  nullable: true
                  description: Requerido para frecuencias anuales
                categoria_gasto_id:
                  type: integer
                  minimum: 1
                importancia_gasto_id:
                  type: integer
                  minimum: 1
                tipo_pago_id:
                  type: integer
                  minimum: 1
                frecuencia_gasto_id:
                  type: integer
                  minimum: 1
                tarjeta_id:
                  type: integer
                  minimum: 1
                  nullable: true
                fecha_inicio:
                  type: string
                  format: date
                  nullable: true
                  description: Fecha a partir de la cual se generan gastos. Si no se envía, se usa la fecha actual.
                generar_mes_actual:
                  type: boolean
                  description: Si es true y no se envía fecha_inicio, se setea al día de pago del mes actual para que el scheduler genere también el gasto del período actual.
      responses:
        '201':
          description: Gasto recurrente creado exitosamente

  /gastos-recurrentes/{id}:
    get:
      tags:
        - gastos-recurrentes
      summary: Obtener gasto recurrente por ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Gasto recurrente encontrado

    put:
      tags:
        - gastos-recurrentes
      summary: Actualizar gasto recurrente
      description: |
        Actualiza un gasto recurrente. Los cambios no afectan gastos ya generados.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                descripcion:
                  type: string
                  minLength: 3
                  maxLength: 255
                monto:
                  type: number
                  minimum: 0.01
                dia_de_pago:
                  type: integer
                  minimum: 1
                  maximum: 31
                mes_de_pago:
                  type: integer
                  minimum: 1
                  maximum: 12
                  nullable: true
                activo:
                  type: boolean
                  description: Activar/desactivar el gasto recurrente
                categoria_gasto_id:
                  type: integer
                  minimum: 1
                importancia_gasto_id:
                  type: integer
                  minimum: 1
                tipo_pago_id:
                  type: integer
                  minimum: 1
                frecuencia_gasto_id:
                  type: integer
                  minimum: 1
                tarjeta_id:
                  type: integer
                  minimum: 1
                  nullable: true
                fecha_inicio:
                  type: string
                  format: date
                  nullable: true
                  description: Fecha a partir de la cual se generan gastos.
      responses:
        '200':
          description: Gasto recurrente actualizado exitosamente

    delete:
      tags:
        - gastos-recurrentes
      summary: Eliminar gasto recurrente
      description: |
        Elimina un gasto recurrente. Los gastos ya generados se mantienen como histórico.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Gasto recurrente eliminado exitosamente

  # DÉBITOS AUTOMÁTICOS
  /debitos-automaticos:
    get:
      tags:
        - debitos-automaticos
      summary: Obtener débitos automáticos con filtros
      description: |
        Obtiene débitos automáticos (suscripciones, servicios) con filtros específicos.
      parameters:
        - name: categoria_gasto_id
          in: query
          schema:
            type: integer
        - name: importancia_gasto_id
          in: query
          schema:
            type: integer
        - name: tipo_pago_id
          in: query
          schema:
            type: integer
        - name: tarjeta_id
          in: query
          schema:
            type: integer
        - name: frecuencia_gasto_id
          in: query
          schema:
            type: integer
          description: Filtrar por frecuencia del débito
        - name: monto_min
          in: query
          schema:
            type: number
        - name: monto_max
          in: query
          schema:
            type: number
        - name: activo
          in: query
          schema:
            type: boolean
          description: Filtrar por estado activo/inactivo
        - name: dia_de_pago
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 31
          description: Día específico del mes para el débito
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 1000
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: orderBy
          in: query
          schema:
            type: string
            enum: [monto, descripcion, dia_de_pago, activo, createdAt, updatedAt]
            default: createdAt
        - name: orderDirection
          in: query
          schema:
            type: string
            enum: [ASC, DESC]
            default: DESC
      responses:
        '200':
          description: Lista de débitos automáticos

    post:
      tags:
        - debitos-automaticos
      summary: Crear débito automático
      description: |
        Crea un nuevo débito automático (suscripción, servicio, etc.).
        Se procesará automáticamente según su frecuencia configurada.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - descripcion
                - monto
                - categoria_gasto_id
                - importancia_gasto_id
                - tipo_pago_id
                - frecuencia_gasto_id
              properties:
                descripcion:
                  type: string
                  minLength: 3
                  maxLength: 255
                  example: "Suscripción Netflix"
                monto:
                  type: number
                  minimum: 0.01
                  example: 1200.00
                dia_de_pago:
                  type: integer
                  minimum: 1
                  maximum: 31
                  nullable: true
                  description: Día del mes para el débito. Null si usa_vencimiento_tarjeta es true.
                  example: 5
                usa_vencimiento_tarjeta:
                  type: boolean
                  default: false
                  description: Si es true, usa el día de vencimiento de la tarjeta de crédito en lugar de dia_de_pago
                  example: false
                categoria_gasto_id:
                  type: integer
                  minimum: 1
                importancia_gasto_id:
                  type: integer
                  minimum: 1
                tipo_pago_id:
                  type: integer
                  minimum: 1
                frecuencia_gasto_id:
                  type: integer
                  minimum: 1
                  description: Frecuencia del débito (mensual, anual, etc.)
                tarjeta_id:
                  type: integer
                  minimum: 1
                  nullable: true
                fecha_inicio:
                  type: string
                  format: date
                  nullable: true
                  description: Fecha a partir de la cual se generan débitos. Si no se envía, se usa la fecha actual.
                generar_mes_actual:
                  type: boolean
                  description: Si es true y no se envía fecha_inicio, se setea al día de pago del mes actual para que el scheduler genere también el débito del período actual.
      responses:
        '201':
          description: Débito automático creado exitosamente

  /debitos-automaticos/{id}:
    get:
      tags:
        - debitos-automaticos
      summary: Obtener débito automático por ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Débito automático encontrado

    put:
      tags:
        - debitos-automaticos
      summary: Actualizar débito automático
      description: |
        Actualiza un débito automático. Los cambios no afectan gastos ya generados.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                descripcion:
                  type: string
                  minLength: 3
                  maxLength: 255
                monto:
                  type: number
                  minimum: 0.01
                dia_de_pago:
                  type: integer
                  minimum: 1
                  maximum: 31
                  nullable: true
                  description: Día del mes para el débito. Null si usa_vencimiento_tarjeta es true.
                usa_vencimiento_tarjeta:
                  type: boolean
                  description: Si es true, usa el día de vencimiento de la tarjeta de crédito en lugar de dia_de_pago
                activo:
                  type: boolean
                  description: Activar/desactivar el débito automático
                categoria_gasto_id:
                  type: integer
                  minimum: 1
                importancia_gasto_id:
                  type: integer
                  minimum: 1
                tipo_pago_id:
                  type: integer
                  minimum: 1
                frecuencia_gasto_id:
                  type: integer
                  minimum: 1
                tarjeta_id:
                  type: integer
                  minimum: 1
                  nullable: true
                fecha_inicio:
                  type: string
                  format: date
                  nullable: true
                  description: Fecha a partir de la cual se generan débitos.
      responses:
        '200':
          description: Débito automático actualizado exitosamente

    delete:
      tags:
        - debitos-automaticos
      summary: Eliminar débito automático
      description: |
        Elimina un débito automático. Los gastos ya generados se mantienen como histórico.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Débito automático eliminado exitosamente

  # =============================================================================
  # TARJETAS ENDPOINTS
  # =============================================================================
  /tarjetas:
    get:
      tags:
        - tarjetas
      summary: Listar tarjetas del usuario
      description: |
        Obtiene todas las tarjetas del usuario autenticado con filtros opcionales y paginación.

        **Filtros disponibles:**
        - `tipo`: Filtrar por tipo de tarjeta (debito, credito, virtual)
        - `banco`: Búsqueda parcial por nombre del banco
        - `permite_cuotas`: Filtrar por capacidad de cuotas (true/false)
        - `limit`: Límite de resultados (1-100)
        - `offset`: Offset para paginación
        - `orderBy`: Campo de ordenamiento (nombre, tipo, banco, id)
        - `orderDirection`: Dirección del ordenamiento (ASC, DESC)
      security:
        - BearerAuth: []
      parameters:
        - name: tipo
          in: query
          schema:
            type: string
            enum: [debito, credito, virtual]
          description: Filtrar por tipo de tarjeta
          example: credito
        - name: banco
          in: query
          schema:
            type: string
            minLength: 1
            maxLength: 100
          description: Búsqueda parcial por nombre del banco
          example: Galicia
        - name: permite_cuotas
          in: query
          schema:
            type: string
            enum: ["true", "false"]
          description: Filtrar por capacidad de cuotas
          example: "true"
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Límite de resultados
          example: 10
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
          description: Offset para paginación
          example: 0
        - name: orderBy
          in: query
          schema:
            type: string
            enum: [nombre, tipo, banco, id]
            default: nombre
          description: Campo de ordenamiento
          example: nombre
        - name: orderDirection
          in: query
          schema:
            type: string
            enum: [ASC, DESC]
            default: ASC
          description: Dirección del ordenamiento
          example: ASC
      responses:
        '200':
          description: Lista de tarjetas obtenida exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Tarjeta'
              examples:
                success:
                  summary: Respuesta exitosa
                  value:
                    success: true
                    data:
                      - id: 1
                        nombre: "Visa Platinum ICBC"
                        tipo: "credito"
                        banco: "ICBC"
                        dia_mes_cierre: 20
                        dia_mes_vencimiento: 10
                        permite_cuotas: true
                        usuario_id: 1
                      - id: 2
                        nombre: "Débito Santander"
                        tipo: "debito"
                        banco: "Banco Santander"
                        dia_mes_cierre: null
                        dia_mes_vencimiento: null
                        permite_cuotas: false
                        usuario_id: 1
                    meta:
                      total: 2
                      type: collection
        '401':
          $ref: '#/components/responses/Unauthorized'
        '400':
          $ref: '#/components/responses/ValidationError'

    post:
      tags:
        - tarjetas
      summary: Crear nueva tarjeta
      description: |
        Crea una nueva tarjeta para el usuario autenticado.

        **Reglas de validación:**
        - Tarjetas de crédito REQUIEREN `dia_mes_cierre` y `dia_mes_vencimiento`
        - Tarjetas de débito NO deben incluir fechas de cierre/vencimiento
        - El campo `permite_cuotas` se auto-configura según el tipo
        - El `usuario_id` se extrae automáticamente del JWT token
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TarjetaInput'
            examples:
              credito:
                summary: Tarjeta de crédito
                value:
                  nombre: "Visa Platinum ICBC"
                  tipo: "credito"
                  banco: "ICBC"
                  dia_mes_cierre: 20
                  dia_mes_vencimiento: 10
              debito:
                summary: Tarjeta de débito
                value:
                  nombre: "Débito Santander"
                  tipo: "debito"
                  banco: "Banco Santander"
      responses:
        '201':
          description: Tarjeta creada exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Tarjeta'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /tarjetas/stats:
    get:
      tags:
        - tarjetas
      summary: Obtener estadísticas de tarjetas
      description: |
        Obtiene estadísticas resumidas de las tarjetas del usuario autenticado.
        Incluye totales por tipo (crédito, débito, virtual).
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Estadísticas obtenidas exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TarjetaStats'
              example:
                success: true
                data:
                  estadisticas:
                    total: 5
                    credito: 3
                    debito: 2
                    virtual: 0
                  usuario_id: 1
        '401':
          $ref: '#/components/responses/Unauthorized'

  /tarjetas/{id}:
    get:
      tags:
        - tarjetas
      summary: Obtener tarjeta por ID
      description: |
        Obtiene una tarjeta específica por su ID. Solo permite acceso a tarjetas
        que pertenecen al usuario autenticado.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
          description: ID de la tarjeta
          example: 1
      responses:
        '200':
          description: Tarjeta obtenida exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Tarjeta'
        '404':
          description: Tarjeta no encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'
              example:
                success: false
                error: "Tarjeta no encontrada"
                timestamp: "2025-01-15T10:30:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'

    put:
      tags:
        - tarjetas
      summary: Actualizar tarjeta
      description: |
        Actualiza una tarjeta existente. Solo permite modificar tarjetas
        que pertenecen al usuario autenticado.

        **Reglas de validación:**
        - Mismas reglas que la creación (crédito requiere fechas, débito no)
        - No se puede cambiar el `usuario_id`
        - Se valida ownership antes de la actualización
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
          description: ID de la tarjeta
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TarjetaInput'
      responses:
        '200':
          description: Tarjeta actualizada exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Tarjeta'
        '404':
          description: Tarjeta no encontrada
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'

    delete:
      tags:
        - tarjetas
      summary: Eliminar tarjeta
      description: |
        Elimina una tarjeta del usuario. Antes de eliminar, verifica que la tarjeta
        no esté siendo utilizada en gastos o compras existentes.

        **Validaciones:**
        - Solo permite eliminar tarjetas del usuario autenticado
        - Verifica que no esté en uso por gastos o compras
        - Si está en uso, devuelve error con detalles de uso
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
          description: ID de la tarjeta
          example: 1
      responses:
        '200':
          description: Tarjeta eliminada exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Tarjeta eliminada exitosamente"
                          tarjeta:
                            type: object
                            properties:
                              id:
                                type: integer
                                example: 1
                              nombre:
                                type: string
                                example: "Visa Platinum ICBC"
                              tipo:
                                type: string
                                example: "credito"
        '400':
          description: Tarjeta en uso, no se puede eliminar
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'
              example:
                success: false
                error: "No se puede eliminar la tarjeta"
                details: "La tarjeta está siendo utilizada en 7 registro(s) (5 gastos, 2 compras)"
                timestamp: "2025-01-15T10:30:00Z"
        '404':
          description: Tarjeta no encontrada
        '401':
          $ref: '#/components/responses/Unauthorized'

  /tarjetas/{id}/usage:
    get:
      tags:
        - tarjetas
      summary: Validar uso de tarjeta
      description: |
        Verifica si una tarjeta está siendo utilizada en gastos o compras.
        Útil antes de intentar eliminar una tarjeta.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
          description: ID de la tarjeta
          example: 1
      responses:
        '200':
          description: Información de uso obtenida exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TarjetaUsage'
              example:
                success: true
                data:
                  tarjeta:
                    id: 1
                    nombre: "Visa Platinum ICBC"
                    tipo: "credito"
                  inUse: true
                  usage:
                    gastos: 5
                    compras: 2
                    total: 7
        '404':
          description: Tarjeta no encontrada
        '401':
          $ref: '#/components/responses/Unauthorized'

  # =============================================================================
  # TIPO DE CAMBIO ENDPOINTS (Multi-Currency System)
  # =============================================================================
  /tipo-cambio:
    get:
      tags:
        - tipo-cambio
      summary: Obtener tipos de cambio con filtros
      description: |
        Obtiene registros históricos de tipos de cambio USD/ARS con filtros opcionales.

        **Casos de uso:**
        - Ver historial de tipos de cambio por fecha
        - Filtrar por fuente (BCRA, DolarAPI)
        - Obtener el tipo de cambio actual (fecha más reciente)
      security:
        - BearerAuth: []
      parameters:
        - name: fecha
          in: query
          schema:
            type: string
            format: date
          description: Filtrar por fecha específica
          example: "2024-01-15"
        - name: fecha_desde
          in: query
          schema:
            type: string
            format: date
          description: Fecha de inicio del rango
          example: "2024-01-01"
        - name: fecha_hasta
          in: query
          schema:
            type: string
            format: date
          description: Fecha de fin del rango
          example: "2024-01-31"
        - name: fuente
          in: query
          schema:
            type: string
          description: Filtrar por fuente (BCRA, DolarAPI)
          example: "BCRA"
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 30
          description: Límite de resultados
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Offset para paginación
      responses:
        '200':
          description: Lista de tipos de cambio
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/TipoCambio'
              example:
                success: true
                data:
                  - id: 1
                    fecha: "2024-01-15"
                    valor_compra: 995.50
                    valor_venta: 1005.50
                    fuente: "BCRA"
                    createdAt: "2024-01-15T00:05:00Z"
                    updatedAt: "2024-01-15T00:05:00Z"
                meta:
                  total: 1
                  type: collection
        '401':
          $ref: '#/components/responses/Unauthorized'

  /tipo-cambio/actual:
    get:
      tags:
        - tipo-cambio
      summary: Obtener tipo de cambio actual
      description: |
        Obtiene el tipo de cambio más reciente (última fecha registrada).

        **Uso típico:** Consultar el tipo de cambio antes de crear un gasto/compra.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Tipo de cambio actual obtenido exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TipoCambio'
              example:
                success: true
                data:
                  id: 1
                  fecha: "2024-01-15"
                  valor_compra: 995.50
                  valor_venta: 1005.50
                  fuente: "BCRA"
                  createdAt: "2024-01-15T00:05:00Z"
                  updatedAt: "2024-01-15T00:05:00Z"
                meta:
                  type: single
        '404':
          description: No hay tipos de cambio registrados
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'
              example:
                success: false
                error: "No se encontró ningún tipo de cambio"
                timestamp: "2024-01-15T10:30:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'

  /tipo-cambio/fecha/{fecha}:
    get:
      tags:
        - tipo-cambio
      summary: Obtener tipo de cambio por fecha
      description: |
        Obtiene el tipo de cambio de una fecha específica.

        **Reglas:**
        - Si existe registro para esa fecha: lo devuelve
        - Si NO existe: devuelve el más cercano anterior (fallback)
        - Si no hay ninguno anterior: error 404
      security:
        - BearerAuth: []
      parameters:
        - name: fecha
          in: path
          required: true
          schema:
            type: string
            format: date
          description: Fecha del tipo de cambio (YYYY-MM-DD)
          example: "2024-01-15"
      responses:
        '200':
          description: Tipo de cambio encontrado
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TipoCambio'
              example:
                success: true
                data:
                  id: 1
                  fecha: "2024-01-15"
                  valor_compra: 995.50
                  valor_venta: 1005.50
                  fuente: "BCRA"
                meta:
                  type: single
        '404':
          description: No hay tipo de cambio disponible para esa fecha
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /tipo-cambio/{id}:
    get:
      tags:
        - tipo-cambio
      summary: Obtener tipo de cambio por ID
      description: Obtiene un tipo de cambio específico por su ID
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
          description: ID del tipo de cambio
          example: 1
      responses:
        '200':
          description: Tipo de cambio encontrado
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TipoCambio'
        '404':
          description: Tipo de cambio no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'
        '401':
          $ref: '#/components/responses/Unauthorized'

    delete:
      tags:
        - tipo-cambio
      summary: Eliminar tipo de cambio
      description: |
        Elimina un registro de tipo de cambio.

        **Advertencia:** Eliminar tipos de cambio históricos puede afectar
        la integridad de los registros de gastos que los utilizaron.
        Solo usar en casos de corrección de errores.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
          description: ID del tipo de cambio
          example: 1
      responses:
        '200':
          description: Tipo de cambio eliminado exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Tipo de cambio eliminado correctamente"
        '404':
          description: Tipo de cambio no encontrado
        '401':
          $ref: '#/components/responses/Unauthorized'

  /tipo-cambio/actualizar:
    post:
      tags:
        - tipo-cambio
      summary: Actualizar tipo de cambio desde APIs externas
      description: |
        Fuerza una actualización del tipo de cambio desde las APIs externas.

        **Fuentes:**
        1. DolarAPI.com (primaria)
        2. BCRA (fallback)

        **Nota:** Normalmente el scheduler ejecuta esto automáticamente a las 00:00 diariamente.
        Este endpoint es útil para actualizaciones manuales.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Tipo de cambio actualizado exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Tipo de cambio actualizado exitosamente"
                          tipoCambio:
                            $ref: '#/components/schemas/TipoCambio'
                          fuente:
                            type: string
                            example: "DolarAPI"
              example:
                success: true
                data:
                  message: "Tipo de cambio actualizado exitosamente"
                  tipoCambio:
                    id: 1
                    fecha: "2024-01-15"
                    valor_compra: 995.50
                    valor_venta: 1005.50
                    fuente: "DolarAPI"
                  fuente: "DolarAPI"
        '500':
          description: Error al obtener tipo de cambio desde APIs externas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'
              example:
                success: false
                error: "Error al obtener tipo de cambio desde APIs externas"
                details: "Ambas fuentes (DolarAPI y BCRA) fallaron"
        '401':
          $ref: '#/components/responses/Unauthorized'

  /tipo-cambio/manual:
    post:
      tags:
        - tipo-cambio
      summary: Configurar tipo de cambio manualmente
      description: |
        Configura un nuevo tipo de cambio manualmente para una fecha específica.

        **Nota:** Normalmente los tipos de cambio se obtienen automáticamente
        mediante el scheduler diario. Este endpoint es útil para:
        - Corregir datos históricos
        - Agregar tipos de cambio manualmente cuando falla la API externa
        - Configurar TC para fechas específicas

        **Validaciones:**
        - valor_venta_usd_ars es requerido
        - valor_compra_usd_ars es opcional (si no se provee, usa el de venta)
        - Ambos valores deben ser números positivos
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - valor_venta_usd_ars
              properties:
                fecha:
                  type: string
                  format: date
                  description: Fecha del tipo de cambio (opcional, por defecto usa hoy)
                  example: "2024-01-15"
                valor_compra_usd_ars:
                  type: number
                  minimum: 0.01
                  description: Valor de compra USD-ARS (opcional, por defecto usa el de venta)
                  example: 995.50
                valor_venta_usd_ars:
                  type: number
                  minimum: 0.01
                  description: Valor de venta USD-ARS (requerido)
                  example: 1005.50
            example:
              fecha: "2024-01-15"
              valor_compra_usd_ars: 995.50
              valor_venta_usd_ars: 1005.50
      responses:
        '201':
          description: Tipo de cambio configurado exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          mensaje:
                            type: string
                            example: "Tipo de cambio configurado exitosamente"
                          tipo_cambio:
                            type: object
                            properties:
                              fecha:
                                type: string
                                format: date
                              valor_compra_usd_ars:
                                type: number
                              valor_venta_usd_ars:
                                type: number
                              fuente:
                                type: string
                                example: "manual"
                              activo:
                                type: boolean
              example:
                success: true
                data:
                  mensaje: "Tipo de cambio configurado exitosamente"
                  tipo_cambio:
                    fecha: "2024-01-15"
                    valor_compra_usd_ars: 995.50
                    valor_venta_usd_ars: 1005.50
                    fuente: "manual"
                    activo: true
        '400':
          description: Error de validación
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'
              examples:
                missing_field:
                  summary: Campo requerido faltante
                  value:
                    success: false
                    error: "Validación fallida"
                    details: "El campo valor_venta_usd_ars es requerido"
                invalid_value:
                  summary: Valor inválido
                  value:
                    success: false
                    error: "Validación fallida"
                    details: "valor_venta_usd_ars debe ser un número positivo"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /tipo-cambio/historico:
    get:
      tags:
        - tipo-cambio
      summary: Obtener histórico de tipos de cambio
      description: |
        Obtiene el historial de tipos de cambio con filtros opcionales.

        **Filtros disponibles:**
        - `fecha_desde`: Filtrar desde una fecha específica
        - `fecha_hasta`: Filtrar hasta una fecha específica
        - `fuente`: Filtrar por fuente (manual, api_dolar_api, api_bcra)
        - `limit`: Limitar cantidad de resultados (default: 30)

        **Orden:** Los resultados se devuelven ordenados por fecha descendente (más recientes primero)
      security:
        - BearerAuth: []
      parameters:
        - name: fecha_desde
          in: query
          schema:
            type: string
            format: date
          description: Fecha desde (YYYY-MM-DD)
          example: "2024-01-01"
        - name: fecha_hasta
          in: query
          schema:
            type: string
            format: date
          description: Fecha hasta (YYYY-MM-DD)
          example: "2024-01-31"
        - name: fuente
          in: query
          schema:
            type: string
            enum: [manual, api_dolar_api, api_bcra]
          description: Filtrar por fuente del tipo de cambio
          example: "api_dolar_api"
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 30
          description: Límite de resultados a devolver
          example: 30
      responses:
        '200':
          description: Histórico obtenido exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          total:
                            type: integer
                            description: Total de registros encontrados
                          filtros:
                            type: object
                            properties:
                              fecha_desde:
                                type: string
                              fecha_hasta:
                                type: string
                              fuente:
                                type: string
                              limit:
                                type: integer
                          datos:
                            type: array
                            items:
                              type: object
                              properties:
                                fecha:
                                  type: string
                                  format: date
                                valor_compra_usd_ars:
                                  type: number
                                valor_venta_usd_ars:
                                  type: number
                                fuente:
                                  type: string
                                activo:
                                  type: boolean
              example:
                success: true
                data:
                  total: 15
                  filtros:
                    fecha_desde: "2024-01-01"
                    fecha_hasta: "2024-01-31"
                    fuente: null
                    limit: 30
                  datos:
                    - fecha: "2024-01-15"
                      valor_compra_usd_ars: 995.50
                      valor_venta_usd_ars: 1005.50
                      fuente: "api_dolar_api"
                      activo: true
                    - fecha: "2024-01-14"
                      valor_compra_usd_ars: 992.00
                      valor_venta_usd_ars: 1002.00
                      fuente: "api_dolar_api"
                      activo: true
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /tipo-cambio/convertir:
    post:
      tags:
        - tipo-cambio
      summary: Convertir monto entre monedas
      description: |
        Convierte un monto entre ARS y USD usando el tipo de cambio actual.

        **Reglas de conversión:**
        - ARS → USD: Usa `valor_venta_usd_ars` (lo que el banco "vende" dólares)
        - USD → ARS: Usa `valor_compra_usd_ars` (lo que el banco "compra" dólares)

        **Nota:** Usa el tipo de cambio más reciente disponible en el sistema.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - monto
                - moneda_origen
              properties:
                monto:
                  type: number
                  minimum: 0.01
                  description: Monto a convertir
                  example: 100000
                moneda_origen:
                  type: string
                  enum: [ARS, USD]
                  description: Moneda del monto original
                  example: "ARS"
            example:
              monto: 100000
              moneda_origen: "ARS"
      responses:
        '200':
          description: Conversión realizada exitosamente
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          monto_original:
                            type: number
                            description: Monto original proporcionado
                          moneda_origen:
                            type: string
                            description: Moneda origen
                          conversion:
                            type: object
                            properties:
                              monto_ars:
                                type: number
                                description: Monto equivalente en pesos argentinos
                              monto_usd:
                                type: number
                                description: Monto equivalente en dólares
                              tipo_cambio_usado:
                                type: number
                                description: Tipo de cambio usado para la conversión
                              fecha_tipo_cambio:
                                type: string
                                format: date
                                description: Fecha del tipo de cambio usado
              example:
                success: true
                data:
                  monto_original: 100000
                  moneda_origen: "ARS"
                  conversion:
                    monto_ars: 100000
                    monto_usd: 99.50
                    tipo_cambio_usado: 1005.50
                    fecha_tipo_cambio: "2024-01-15"
        '400':
          description: Error de validación
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'
              examples:
                missing_fields:
                  summary: Campos requeridos faltantes
                  value:
                    success: false
                    error: "Validación fallida"
                    details: "Los campos monto y moneda_origen son requeridos"
                invalid_currency:
                  summary: Moneda inválida
                  value:
                    success: false
                    error: "Validación fallida"
                    details: "moneda_origen debe ser ARS o USD"
                invalid_amount:
                  summary: Monto inválido
                  value:
                    success: false
                    error: "Validación fallida"
                    details: "monto debe ser un número positivo"
        '404':
          description: Tipo de cambio no disponible
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardError'
              example:
                success: false
                error: "Tipo de cambio no disponible"
                details: "No hay tipo de cambio configurado"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  # ============================================================================
  # PROYECCION ENDPOINTS
  # ============================================================================
  /proyeccion:
    get:
      tags:
        - proyeccion
      summary: Obtener proyección de gastos futuros
      description: |
        Proyecta gastos futuros basándose en:
        - Gastos recurrentes activos
        - Débitos automáticos activos
        - Cuotas pendientes de compras

        La proyección considera las frecuencias configuradas y calcula
        las fechas exactas de cada gasto proyectado.
      operationId: obtenerProyeccion
      security:
        - BearerAuth: []
      parameters:
        - name: meses
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 12
            default: 3
          description: Cantidad de meses a proyectar hacia el futuro (1-12)
      responses:
        '200':
          description: Proyección generada exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      proyeccion:
                        type: array
                        description: Proyección mes a mes
                        items:
                          type: object
                          properties:
                            mes:
                              type: string
                              example: "2026-03"
                            total_ars:
                              type: number
                              example: 150000
                            total_usd:
                              type: number
                              example: 200
                            cantidad_gastos:
                              type: integer
                              example: 15
                            gastos:
                              type: array
                              items:
                                type: object
                                properties:
                                  tipo:
                                    type: string
                                    enum: [recurrente, debito_automatico, compra]
                                  id_origen:
                                    type: integer
                                  descripcion:
                                    type: string
                                  monto_ars:
                                    type: number
                                  monto_usd:
                                    type: number
                                  fecha_proyectada:
                                    type: string
                                    format: date
                                  categoria:
                                    type: string
                                  importancia:
                                    type: string
                      resumen:
                        type: object
                        properties:
                          total_ars:
                            type: number
                            description: Total en ARS de todos los meses
                          total_usd:
                            type: number
                            description: Total en USD de todos los meses
                          meses_proyectados:
                            type: integer
                          promedio_mensual_ars:
                            type: number
                          promedio_mensual_usd:
                            type: number
              example:
                success: true
                data:
                  proyeccion:
                    - mes: "2026-03"
                      total_ars: 150000
                      total_usd: 200
                      cantidad_gastos: 8
                      gastos:
                        - tipo: "recurrente"
                          id_origen: 1
                          descripcion: "Alquiler"
                          monto_ars: 80000
                          monto_usd: 0
                          fecha_proyectada: "2026-03-10"
                          categoria: "Alquiler"
                          importancia: "Necesario"
                        - tipo: "debito_automatico"
                          id_origen: 2
                          descripcion: "Netflix"
                          monto_ars: 5000
                          monto_usd: 0
                          fecha_proyectada: "2026-03-15"
                          categoria: "Streaming / Suscripciones"
                          importancia: "Deseado"
                  resumen:
                    total_ars: 450000
                    total_usd: 600
                    meses_proyectados: 3
                    promedio_mensual_ars: 150000
                    promedio_mensual_usd: 200
        '400':
          description: Parámetros de validación inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  # ============================================================================
  # SALUD FINANCIERA ENDPOINTS
  # ============================================================================
  /salud-financiera:
    get:
      tags:
        - salud-financiera
      summary: Obtener análisis de salud financiera
      description: |
        Calcula un puntaje de salud financiera (0-100) basado en:
        - **Ratio de gastos necesarios** (40%): Porcentaje de gastos marcados como "Necesario"
        - **Gastos prescindibles** (30%): Penalización por gastos "Prescindible"
        - **Tendencia** (20%): Comparación con el período anterior
        - **Diversificación** (10%): Distribución entre categorías

        Incluye recomendaciones personalizadas basadas en los patrones de gasto.
      operationId: obtenerSaludFinanciera
      security:
        - BearerAuth: []
      parameters:
        - name: periodo
          in: query
          schema:
            type: string
            enum: [semana, mes, trimestre, anio]
            default: mes
          description: Período de análisis
      responses:
        '200':
          description: Análisis de salud financiera generado exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      score:
                        type: integer
                        minimum: 0
                        maximum: 100
                        description: Puntaje de salud financiera
                      calificacion:
                        type: string
                        enum: [Excelente, Muy Buena, Buena, Regular, Mejorable, Crítica]
                      periodo:
                        type: object
                        properties:
                          tipo:
                            type: string
                          desde:
                            type: string
                            format: date
                          hasta:
                            type: string
                            format: date
                      totales:
                        type: object
                        properties:
                          total_ars:
                            type: number
                          cantidad_gastos:
                            type: integer
                      desglose:
                        type: object
                        properties:
                          ratio_esenciales:
                            type: object
                            properties:
                              valor:
                                type: number
                              descripcion:
                                type: string
                              peso:
                                type: integer
                              puntos:
                                type: number
                          gastos_evitables:
                            type: object
                          tendencia:
                            type: object
                          diversificacion:
                            type: object
                      distribucion:
                        type: object
                        properties:
                          por_importancia:
                            type: object
                          por_categoria:
                            type: object
                          por_tipo_pago:
                            type: object
                      recomendaciones:
                        type: array
                        items:
                          type: string
              example:
                success: true
                data:
                  score: 72
                  calificacion: "Buena"
                  periodo:
                    tipo: "mes"
                    desde: "2026-02-01"
                    hasta: "2026-02-28"
                  totales:
                    total_ars: 180000
                    cantidad_gastos: 25
                  desglose:
                    ratio_esenciales:
                      valor: 65
                      descripcion: "65% de gastos son necesarios"
                      peso: 40
                      puntos: 26
                    gastos_evitables:
                      valor: 5
                      descripcion: "5% de gastos son prescindibles"
                      peso: 30
                      puntos: 25.5
                    tendencia:
                      valor: -3
                      descripcion: "Gastos disminuyeron 3%"
                      peso: 20
                      puntos: 14
                    diversificacion:
                      valor: 35
                      descripcion: "Gastos moderadamente diversificados"
                      peso: 10
                      puntos: 6.5
                  distribucion:
                    por_importancia:
                      Necesario:
                        total_ars: 100000
                        cantidad: 10
                      Deseado:
                        total_ars: 45000
                        cantidad: 8
                      Prescindible:
                        total_ars: 9000
                        cantidad: 2
                    por_categoria:
                      Alquiler:
                        total_ars: 80000
                        cantidad: 1
                      Supermercado:
                        total_ars: 35000
                        cantidad: 8
                  recomendaciones:
                    - "Los gastos disminuyeron respecto al mes anterior - seguí así"
                    - "Considerá reducir gastos prescindibles"
        '400':
          description: Parámetros de validación inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'