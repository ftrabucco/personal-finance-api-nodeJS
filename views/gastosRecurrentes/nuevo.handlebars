<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Nuevo Gasto Recurrente</h1>
</div>

<div class="row">
  <div class="col-md-6">
    {{#if error}}
    <div class="alert alert-danger" role="alert">
      {{error}}
    </div>
    {{/if}}
    <form method="POST" action="/gastos-recurrentes/nuevo" class="needs-validation" novalidate>
      <div class="mb-3">
        <label class="form-label">Descripción:</label>
        <input type="text" name="descripcion" class="form-control" value="{{formData.descripcion}}" required />
      </div>

      <div class="mb-3">
        <label class="form-label">Monto:</label>
        <input type="number" name="monto" step="0.01" class="form-control" value="{{formData.monto}}" required />
      </div>

      <div class="mb-3">
        <label class="form-label">Día de pago:</label>
        <input type="number" name="dia_de_pago" min="1" max="31" class="form-control" value="{{formData.dia_de_pago}}" required />
        <div class="form-text">Día del mes en que se realiza el gasto</div>
      </div>

      <div class="mb-3">
        <label class="form-label">Frecuencia:</label>
        <select name="frecuencia_gasto_id" class="form-select" required id="frecuencia_select">
          <option value="">Seleccione una frecuencia</option>
          {{#each frecuencias}}
            <option value="{{this.id}}" data-frecuencia="{{this.nombre_frecuencia}}" {{selected this.id ../formData.frecuencia_gasto_id}}>{{this.nombre_frecuencia}}</option>
          {{/each}}
        </select>
      </div>

      <div class="mb-3" id="mes_pago_container" style="display: none;">
        <label class="form-label">Mes de pago:</label>
        <select name="mes_de_pago" class="form-select">
          <option value="">Seleccione el mes (requerido para gastos anuales)</option>
          <option value="1" {{selected 1 formData.mes_de_pago}}>Enero</option>
          <option value="2" {{selected 2 formData.mes_de_pago}}>Febrero</option>
          <option value="3" {{selected 3 formData.mes_de_pago}}>Marzo</option>
          <option value="4" {{selected 4 formData.mes_de_pago}}>Abril</option>
          <option value="5" {{selected 5 formData.mes_de_pago}}>Mayo</option>
          <option value="6" {{selected 6 formData.mes_de_pago}}>Junio</option>
          <option value="7" {{selected 7 formData.mes_de_pago}}>Julio</option>
          <option value="8" {{selected 8 formData.mes_de_pago}}>Agosto</option>
          <option value="9" {{selected 9 formData.mes_de_pago}}>Septiembre</option>
          <option value="10" {{selected 10 formData.mes_de_pago}}>Octubre</option>
          <option value="11" {{selected 11 formData.mes_de_pago}}>Noviembre</option>
          <option value="12" {{selected 12 formData.mes_de_pago}}>Diciembre</option>
        </select>
        <div class="form-text">Solo requerido para gastos con frecuencia anual</div>
      </div>

      <div class="mb-3">
        <label class="form-label">Categoría:</label>
        <select name="categoria_gasto_id" class="form-select" required>
          <option value="">Seleccione una categoría</option>
          {{#each categorias}}
            <option value="{{this.id}}" {{selected this.id ../formData.categoria_gasto_id}}>{{this.nombre_categoria}}</option>
          {{/each}}
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Importancia:</label>
        <select name="importancia_gasto_id" class="form-select" required>
          <option value="">Seleccione una importancia</option>
          {{#each importancias}}
            <option value="{{this.id}}" {{selected this.id ../formData.importancia_gasto_id}}>{{this.nombre_importancia}}</option>
          {{/each}}
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Tipo de pago:</label>
        <select name="tipo_pago_id" class="form-select" required>
          <option value="">Seleccione un tipo de pago</option>
          {{#each tiposPago}}
            <option value="{{this.id}}" {{selected this.id ../formData.tipo_pago_id}}>{{this.nombre}}</option>
          {{/each}}
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Tarjeta:</label>
        <select name="tarjeta_id" class="form-select">
          <option value="">Seleccione una tarjeta (opcional)</option>
          {{#each tarjetas}}
            <option value="{{this.id}}" {{selected this.id ../formData.tarjeta_id}}>{{this.nombre}} - {{this.banco}}</option>
          {{/each}}
        </select>
      </div>

      <div class="mb-3">
        <button type="submit" class="btn btn-primary">Guardar</button>
        <a href="/gastos-recurrentes" class="btn btn-secondary">Cancelar</a>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const frecuenciaSelect = document.getElementById('frecuencia_select');
  const mesPagoContainer = document.getElementById('mes_pago_container');
  const mesPagoSelect = mesPagoContainer.querySelector('select[name="mes_de_pago"]');
  
  function toggleMesPago() {
    const selectedOption = frecuenciaSelect.querySelector('option:checked');
    const frecuenciaNombre = selectedOption ? selectedOption.dataset.frecuencia : '';
    
    if (frecuenciaNombre && frecuenciaNombre.toLowerCase() === 'anual') {
      mesPagoContainer.style.display = 'block';
      mesPagoSelect.required = true;
    } else {
      mesPagoContainer.style.display = 'none';
      mesPagoSelect.required = false;
      mesPagoSelect.value = '';
    }
  }
  
  // Check initial state
  toggleMesPago();
  
  // Listen for changes
  frecuenciaSelect.addEventListener('change', toggleMesPago);
});
</script> 